# üìã Plano de Deploy - AWS Elastic Beanstalk

## üéØ Objetivo
Migrar o backend Express.js da aplica√ß√£o Operabase para AWS Elastic Beanstalk, mantendo o frontend no Vercel.

## üìä An√°lise da Estrutura Atual

### ‚úÖ Funcionalidades Implementadas
- **Backend Express.js** com TypeScript e arquitetura multi-tenant
- **Sistema de cache Redis** com fallback para mem√≥ria (obrigat√≥rio)
- **WebSocket** para comunica√ß√£o em tempo real
- **Observabilidade completa** com m√©tricas e logs
- **Supabase** como banco de dados (PostgreSQL + Storage)
- **Middleware de performance** e monitoramento
- **Sistema de autentica√ß√£o** com sess√µes
- **Upload de arquivos** com Supabase Storage
- **Integra√ß√£o WhatsApp** via Evolution API
- **Integra√ß√£o Google Calendar** com sync bidirecional
- **Sistema de conversas** com AI e WebSocket
- **RAG (Retrieval Augmented Generation)** com LangChain
- **Anamneses** com formul√°rios din√¢micos
- **Pipeline de vendas** com CRM
- **Analytics** e relat√≥rios
- **Calend√°rio** com agendamentos
- **Prontu√°rios m√©dicos**
- **Sistema de tags** para agendamentos
- **Gerenciamento de equipe** e permiss√µes
- **AI Templates** para automa√ß√£o
- **N8N integration** para workflows

### ‚ö†Ô∏è Depend√™ncias Externas Cr√≠ticas
- **Supabase** (PostgreSQL + Storage + Auth)
- **Redis** (cache - **OBRIGAT√ìRIO** para WebSocket e performance)
- **OpenAI API** (AI features e RAG)
- **Google Calendar API** (integra√ß√£o calend√°rio)
- **Evolution API** (WhatsApp integration)
- **N8N** (automa√ß√£o de workflows)

## üèóÔ∏è Estrat√©gia de Deploy

### **Op√ß√£o Recomendada: AWS Elastic Beanstalk**
- ‚úÖ **Simplicidade**: Deploy com um comando
- ‚úÖ **Escalabilidade autom√°tica**: Auto Scaling Group
- ‚úÖ **Load Balancer**: Application Load Balancer inclu√≠do
- ‚úÖ **Health Checks**: Monitoramento autom√°tico
- ‚úÖ **SSL/TLS**: Certificado gratuito via ACM
- ‚úÖ **Logs centralizados**: CloudWatch Logs
- ‚úÖ **Rollback autom√°tico**: Em caso de falha

## üìã Checklist de Prepara√ß√£o

### **Fase 1: Prepara√ß√£o do C√≥digo**

#### 1.1 Separa√ß√£o Frontend/Backend ‚úÖ
- [x] Frontend j√° configurado para Vercel
- [x] Backend Express independente
- [x] Build separado configurado no package.json

#### 1.2 Configura√ß√£o de Ambiente
- [ ] Criar arquivo `.env.production`
- [ ] Configurar vari√°veis de ambiente para produ√ß√£o
- [ ] Remover depend√™ncias de desenvolvimento do build

#### 1.3 Otimiza√ß√µes de Build
- [ ] Configurar build do servidor com esbuild
- [ ] Otimizar bundle para produ√ß√£o
- [ ] Configurar start script para produ√ß√£o

### **Fase 2: Configura√ß√£o AWS & CI/CD**

#### 2.1 Arquivos de Configura√ß√£o
- [ ] `.ebextensions/` - Configura√ß√µes do Elastic Beanstalk
- [ ] `Procfile` - Comando de inicializa√ß√£o
- [ ] `.github/workflows/deploy.yml` - GitHub Actions
- [ ] `.platform/` - Hooks de deploy (se necess√°rio)

#### 2.2 Configura√ß√£o de Vari√°veis
- [ ] Configurar todas as vari√°veis de ambiente no EB
- [ ] Configurar secrets no GitHub Actions
- [ ] Configurar secrets no AWS Systems Manager
- [ ] Configurar certificado SSL

#### 2.3 Servi√ßos Auxiliares & CI/CD
- [ ] Configurar ElastiCache Redis (opcional)
- [ ] Configurar CloudWatch Logs
- [ ] Configurar Route 53 para DNS
- [ ] Configurar GitHub Actions secrets
- [ ] Testar pipeline de CI/CD

### **Fase 3: Deploy e Testes**

#### 3.1 Deploy Inicial
- [ ] Deploy em ambiente de staging
- [ ] Testes de funcionalidade
- [ ] Testes de performance

#### 3.2 Configura√ß√£o de Dom√≠nio
- [ ] Configurar dom√≠nio customizado
- [ ] Configurar certificado SSL
- [ ] Configurar CORS para frontend

#### 3.3 Monitoramento
- [ ] Configurar alertas CloudWatch
- [ ] Configurar logs de aplica√ß√£o
- [ ] Configurar m√©tricas customizadas

## üîß Arquivos de Configura√ß√£o

### **1. .ebextensions/01-nodecommand.config**

#### **Para MVP (Todas as Funcionalidades)**
```yaml
option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    PORT: 8080
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /health: dist/health.html
  # Configura√ß√µes para t3.small com Redis
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.small
    RootVolumeType: gp3
    RootVolumeSize: 15
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 1
  aws:elasticbeanstalk:environment:
    EnvironmentType: SingleInstance
```

#### **Para Produ√ß√£o (Configura√ß√£o Completa)**
```yaml
option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    PORT: 8080
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /health: dist/health.html
  # Configura√ß√µes para produ√ß√£o
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.small
    RootVolumeType: gp3
    RootVolumeSize: 20
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 3
  aws:elasticbeanstalk:environment:
    EnvironmentType: LoadBalanced
```

### **2. .ebextensions/02-environment.config**
```yaml
option_settings:
  aws:elasticbeanstalk:application:environment:
    # Database
    SUPABASE_URL: "https://your-project.supabase.co"
    SUPABASE_ANON_KEY: "your-anon-key"
    SUPABASE_SERVICE_ROLE_KEY: "your-service-role-key"
    SUPABASE_POOLER_URL: "your-pooler-url"
    
    # Cache (opcional)
    REDIS_URL: "redis://your-elasticache-endpoint:6379"
    
    # APIs
    OPENAI_API_KEY: "your-openai-key"
    GOOGLE_CLIENT_ID: "your-google-client-id"
    GOOGLE_CLIENT_SECRET: "your-google-client-secret"
    
    # Security
    SESSION_SECRET: "your-session-secret"
    
    # Features
    ENABLE_PAGINATION: "true"
```

### **3. .ebextensions/03-logs.config**
```yaml
files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/01-app-logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/eb-engine.log
      /var/log/eb-hooks.log
      /var/app/current/logs/*.log

option_settings:
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7
```

### **4. Procfile**
```
web: npm start
```

### **5. package.json - Scripts Atualizados**

#### **Para MVP (Otimizado para t3.micro)**
```json
{
  "scripts": {
    "dev": "NODE_ENV=development tsx --env-file=.env server/index.ts",
    "build": "npm run build:server",
    "build:server": "esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist --external:@shared/schema --external:../shared/schema.js --external:./shared/schema.js --external:drizzle-orm --external:postgres --external:pg --external:ioredis --external:socket.io --minify",
    "start": "NODE_ENV=production node --max-old-space-size=512 dist/index.js",
    "postinstall": "npm run build"
  },
  "engines": {
    "node": "18.x"
  }
}
```

#### **Para Produ√ß√£o (Performance Completa)**
```json
{
  "scripts": {
    "dev": "NODE_ENV=development tsx --env-file=.env server/index.ts",
    "build": "npm run build:server",
    "build:server": "esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist --external:@shared/schema --external:../shared/schema.js --external:./shared/schema.js --external:drizzle-orm --external:postgres --external:pg --external:ioredis --external:socket.io",
    "start": "NODE_ENV=production node dist/index.js",
    "postinstall": "npm run build"
  },
  "engines": {
    "node": "18.x"
  }
}
```

## üöÄ CI/CD Autom√°tico com GitHub Actions

### **Estrat√©gia de Deploy Autom√°tico**
- **Frontend**: Vercel (j√° configurado) ‚úÖ
- **Backend**: AWS Elastic Beanstalk via GitHub Actions ‚úÖ
- **Trigger**: Push para branch `main` ou `production`
- **Rollback**: Autom√°tico em caso de falha

### **6. .github/workflows/deploy.yml**
```yaml
name: Deploy to AWS Elastic Beanstalk

on:
  push:
    branches: [ main, production ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm test --if-present
    
    - name: Build application
      run: npm run build

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/production'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build application
      run: npm run build
    
    - name: Generate deployment package
      run: |
        zip -r deploy.zip . -x "*.git*" "node_modules/*" "src/*" "*.md" "docs/*" "examples/*"
    
    - name: Deploy to EB
      uses: einaregilsson/beanstalk-deploy@v21
      with:
        aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        application_name: operabase-backend
        environment_name: ${{ github.ref == 'refs/heads/main' && 'operabase-backend-mvp' || 'operabase-backend-prod' }}
        version_label: ${{ github.sha }}
        region: us-east-1
        deployment_package: deploy.zip
        wait_for_environment_recovery: 300
```

### **7. Configura√ß√£o de Secrets no GitHub**
No seu reposit√≥rio GitHub, v√° em **Settings ‚Üí Secrets and variables ‚Üí Actions** e adicione:

```
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-east-1
EB_APPLICATION_NAME=operabase-backend
EB_ENVIRONMENT_NAME=operabase-backend-prod
```

## üîÑ Processo de Deploy Autom√°tico

### **Fluxo Completo**
1. **Push no GitHub** ‚Üí Trigger autom√°tico
2. **GitHub Actions** ‚Üí Build e testes
3. **Vercel** ‚Üí Deploy autom√°tico do frontend
4. **AWS EB** ‚Üí Deploy autom√°tico do backend
5. **Notifica√ß√µes** ‚Üí Status via GitHub/Slack

### **Processo Manual (Setup Inicial)**

#### **Passo 1: Prepara√ß√£o Local**
```bash
# 1. Instalar EB CLI
pip install awsebcli

# 2. Configurar AWS credentials
aws configure

# 3. Testar build local
npm run build
npm start
```

#### **Passo 2: Inicializa√ß√£o EB (Uma vez)**

##### **Para MVP (Todas as Funcionalidades)**
```bash
# 1. Inicializar aplica√ß√£o EB
eb init operabase-backend --platform "Node.js 18" --region us-east-1

# 2. Criar ambiente MVP com Redis
eb create operabase-backend-mvp \
  --instance-type t3.small \
  --min-instances 1 \
  --max-instances 1 \
  --single-instance

# 3. Configurar ElastiCache Redis
aws elasticache create-cache-cluster \
  --cache-cluster-id operabase-mvp-redis \
  --cache-node-type cache.t3.micro \
  --engine redis \
  --num-cache-nodes 1

# 4. Configurar todas as vari√°veis de ambiente
eb setenv \
  NODE_ENV=production \
  SUPABASE_URL=https://your-project.supabase.co \
  SUPABASE_SERVICE_ROLE_KEY=your-service-key \
  REDIS_URL=redis://operabase-mvp-redis.cache.amazonaws.com:6379 \
  OPENAI_API_KEY=your-openai-key \
  GOOGLE_CLIENT_ID=your-google-id \
  EVOLUTION_API_KEY=your-evolution-key
```

##### **Para Produ√ß√£o (Recomendado)**
```bash
# 1. Inicializar aplica√ß√£o EB
eb init operabase-backend --platform "Node.js 18" --region us-east-1

# 2. Criar ambiente produ√ß√£o
eb create operabase-backend-prod \
  --instance-type t3.small \
  --min-instances 1 \
  --max-instances 3

# 3. Configurar vari√°veis de ambiente
eb setenv NODE_ENV=production SUPABASE_URL=https://your-project.supabase.co [...]
```

#### **Passo 3: Deploy Manual (Emerg√™ncia)**
```bash
# 1. Deploy manual (se necess√°rio)
eb deploy

# 2. Verificar sa√∫de
eb health

# 3. Ver logs
eb logs

# 4. Abrir aplica√ß√£o
eb open
```

## üìä Configura√ß√£o de Vari√°veis de Ambiente

### **üîë Obrigat√≥rias (MVP)**
```env
NODE_ENV=production
PORT=8080

# Database - Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_POOLER_URL=your-pooler-url
SUPABASE_CONNECTION_STRING=postgresql://user:pass@host:port/db

# Cache - Redis (obrigat√≥rio para WebSocket)
REDIS_URL=redis://your-elasticache-endpoint:6379

# Security
SESSION_SECRET=your-strong-session-secret-min-32-chars
```

### **üöÄ Funcionalidades Espec√≠ficas**
```env
# AI Features
OPENAI_API_KEY=sk-your-openai-key-here

# Google Calendar Integration
GOOGLE_CLIENT_ID=your-google-oauth-client-id
GOOGLE_CLIENT_SECRET=your-google-oauth-client-secret
GOOGLE_REDIRECT_URI=https://your-domain.com/api/calendar/callback/google

# WhatsApp Integration
EVOLUTION_API_KEY=your-evolution-api-key
EVOLUTION_API_URL=https://your-evolution-instance.com
EVOLUTION_URL=https://your-evolution-instance.com

# N8N Integration
N8N_WEBHOOK_URL=https://your-n8n-instance.com/webhook

# Feature Flags
ENABLE_PAGINATION=true
ENABLE_REDIS_CACHE=true
```

### **üîß Opcionais (com fallbacks)**
```env
# Development/Debug
REPLIT_DOMAINS=your-replit-domain.replit.app
WEBHOOK_BASE_URL=https://your-domain.com

# Google Webhook
GOOGLE_WEBHOOK_TOKEN=your-webhook-verification-token

# Database Alternatives
DATABASE_URL=postgresql://fallback-connection
SUPABASE_DATABASE_URL=postgresql://alternative-connection
```

## üîç Monitoramento e Logs

### **CloudWatch Logs**
- `/aws/elasticbeanstalk/operabase-backend-prod/var/log/eb-engine.log`
- `/aws/elasticbeanstalk/operabase-backend-prod/var/log/nodejs/nodejs.log`

### **M√©tricas Customizadas**
- Response time
- Error rate
- Cache hit rate
- Database connections
- WebSocket connections

### **Health Checks**
- **Endpoint**: `/api/health`
- **Timeout**: 30 segundos
- **Interval**: 15 segundos
- **Threshold**: 3 falhas consecutivas

## üí∞ Estimativa de Custos (Mensal)

### **üöÄ Configura√ß√£o MVP (Completa)**
- **EC2 t3.small** (1 inst√¢ncia): ~$15/m√™s
- **ElastiCache t3.micro** (Redis): ~$15/m√™s
- **Application Load Balancer**: ~$20/m√™s
- **CloudWatch Logs b√°sico**: ~$5/m√™s
- **Data Transfer**: ~$10/m√™s
- **Total MVP**: ~$65/m√™s

#### **‚úÖ Funcionalidades Inclu√≠das no MVP**
- ‚úÖ **Todas as funcionalidades** da aplica√ß√£o atual
- ‚úÖ **Redis cache** para performance e WebSocket
- ‚úÖ **WebSocket** para tempo real
- ‚úÖ **WhatsApp integration** via Evolution API
- ‚úÖ **Google Calendar sync** bidirecional
- ‚úÖ **AI features** com OpenAI
- ‚úÖ **RAG system** com LangChain
- ‚úÖ **Upload de arquivos** com Supabase Storage
- ‚úÖ **Sistema completo** de conversas e CRM
- ‚úÖ **Anamneses** e formul√°rios din√¢micos
- ‚úÖ **Pipeline de vendas** e analytics
- ‚úÖ **Prontu√°rios m√©dicos** e agendamentos

#### **‚ö†Ô∏è Limita√ß√µes do MVP**
- ‚ö†Ô∏è **Disponibilidade**: Inst√¢ncia √∫nica (sem redund√¢ncia)
- ‚ö†Ô∏è **Escalabilidade**: Limitada para at√© 50 usu√°rios simult√¢neos
- ‚ö†Ô∏è **CPU**: 1 vCPU (pode ser lento em picos de AI)
- ‚úÖ **Ideal para**: Valida√ß√£o, at√© 50 usu√°rios, todas as funcionalidades

#### **üîÑ Quando Migrar para Produ√ß√£o**
- üë• **Mais de 50 usu√°rios simult√¢neos**
- üöÄ **Necessidade de alta disponibilidade**
- üîÑ **Necessidade de redund√¢ncia**
- üìä **Uso intensivo de AI/WebSocket**

### **üìà Configura√ß√£o B√°sica**
- **EC2 t3.small** (1 inst√¢ncia): ~$15/m√™s
- **Application Load Balancer**: ~$20/m√™s
- **ElastiCache t3.micro** (opcional): ~$15/m√™s
- **CloudWatch Logs**: ~$5/m√™s
- **Data Transfer**: ~$10/m√™s
- **Total B√°sica**: ~$65/m√™s

### **üè¢ Configura√ß√£o Escal√°vel**
- **EC2 t3.large (2 inst√¢ncias)**: ~$120/m√™s
- **Application Load Balancer**: ~$20/m√™s
- **ElastiCache t3.small**: ~$30/m√™s
- **CloudWatch**: ~$15/m√™s
- **Total Escal√°vel**: ~$185/m√™s

## üìä Comparativo de Configura√ß√µes

| Recurso | MVP | B√°sica | Escal√°vel |
|---------|-----|--------|-----------|
| **üí∞ Custo/m√™s** | ~$65 | ~$65 | ~$185 |
| **üñ•Ô∏è Inst√¢ncia** | t3.small | t3.small | t3.large x2 |
| **üíæ RAM** | 2GB | 2GB | 8GB |
| **‚ö° vCPU** | 1 | 1 | 4 |
| **üë• Usu√°rios** | 50 | 50-100 | 500+ |
| **üîÑ Auto Scaling** | ‚ùå | ‚úÖ | ‚úÖ |
| **üè• Load Balancer** | ‚ùå | ‚úÖ | ‚úÖ |
| **üìä Redis Cache** | ‚úÖ | ‚úÖ | ‚úÖ |
| **üîç Monitoramento** | B√°sico | Completo | Avan√ßado |
| **‚è±Ô∏è Downtime** | Poss√≠vel | M√≠nimo | Zero |
| **üéØ Ideal para** | Testes/Valida√ß√£o | Startup | Empresa |

## üîí Seguran√ßa

### **Configura√ß√µes Recomendadas**
- **HTTPS only**: For√ßa SSL/TLS
- **Security Groups**: Portas 80/443 apenas
- **IAM Roles**: Permiss√µes m√≠nimas
- **Secrets Manager**: Para chaves sens√≠veis
- **VPC**: Isolamento de rede

## üö® Troubleshooting

### **Problemas Comuns**
1. **Build failure**: Verificar dependencies e scripts
2. **Environment variables**: Verificar todas as vari√°veis obrigat√≥rias
3. **Database connection**: Verificar Supabase URLs e keys
4. **Memory issues**: Aumentar instance type
5. **WebSocket issues**: Verificar sticky sessions

### **Comandos √öteis**
```bash
# Ver logs em tempo real
eb logs --all

# SSH na inst√¢ncia
eb ssh

# Ver configura√ß√£o atual
eb config

# Rollback para vers√£o anterior
eb deploy --version=previous
```

## ‚úÖ Checklist Final

### **Antes do Deploy**
- [ ] Todas as vari√°veis de ambiente configuradas
- [ ] Build funciona localmente
- [ ] Testes passando
- [ ] Backup do banco de dados
- [ ] DNS preparado

### **Ap√≥s Deploy**
- [ ] Health check passando
- [ ] Logs sem erros cr√≠ticos
- [ ] Frontend conectando ao backend
- [ ] WebSocket funcionando
- [ ] Cache funcionando (se configurado)
- [ ] M√©tricas sendo coletadas

### **Configura√ß√£o de Dom√≠nio**
- [ ] Certificado SSL configurado
- [ ] CORS configurado para frontend
- [ ] Route 53 apontando para EB
- [ ] Redirecionamento HTTP ‚Üí HTTPS

## üîÑ Migra√ß√£o MVP ‚Üí Produ√ß√£o

### **Quando Migrar**
- üë• **Usu√°rios**: Mais de 20 usu√°rios simult√¢neos
- üìä **M√©tricas**: CPU > 80% ou Mem√≥ria > 90%
- üöÄ **Performance**: Response time > 2 segundos
- üíº **Neg√≥cio**: Receita validada

### **Processo de Migra√ß√£o**
```bash
# 1. Criar novo ambiente produ√ß√£o
eb create operabase-backend-prod \
  --instance-type t3.small \
  --min-instances 1 \
  --max-instances 3

# 2. Configurar vari√°veis de ambiente
eb setenv NODE_ENV=production [todas-as-vars]

# 3. Deploy no novo ambiente
eb deploy operabase-backend-prod

# 4. Testar novo ambiente
eb open operabase-backend-prod

# 5. Atualizar DNS (Route 53)
# 6. Terminar ambiente MVP
eb terminate operabase-backend-mvp
```

### **Custo da Migra√ß√£o**
- **Durante migra√ß√£o**: ~$100/m√™s (2 ambientes)
- **Ap√≥s migra√ß√£o**: ~$65/m√™s (s√≥ produ√ß√£o)
- **Economia anual**: Migra√ß√£o planejada vs emergencial

## üîÑ Workflow de Desenvolvimento

### **Fluxo de Trabalho Di√°rio**
```bash
# 1. Desenvolvimento local
git checkout -b feature/nova-funcionalidade
# ... fazer altera√ß√µes ...
git add .
git commit -m "feat: nova funcionalidade"
git push origin feature/nova-funcionalidade

# 2. Pull Request
# Criar PR no GitHub ‚Üí Testes autom√°ticos

# 3. Merge para main
# Merge PR ‚Üí Deploy autom√°tico para produ√ß√£o
```

### **Branches e Ambientes**
- **`main`** ‚Üí Deploy autom√°tico para **produ√ß√£o**
- **`develop`** ‚Üí Deploy autom√°tico para **staging** (opcional)
- **`feature/*`** ‚Üí Apenas testes, sem deploy

## üìä Monitoramento do CI/CD

### **GitHub Actions Dashboard**
- Status de builds em tempo real
- Logs detalhados de cada deploy
- Notifica√ß√µes de falhas
- Hist√≥rico de deployments

### **AWS CloudWatch**
- M√©tricas de aplica√ß√£o
- Logs de deploy
- Alertas autom√°ticos
- Health checks

## üìû Pr√≥ximos Passos

1. **Revisar e aprovar este plano**
2. **Preparar arquivos de configura√ß√£o**
3. **Configurar ambiente AWS**
4. **Configurar GitHub Actions**
5. **Executar deploy em staging**
6. **Testar pipeline completo**
7. **Deploy em produ√ß√£o**
8. **Monitoramento p√≥s-deploy**

---

## ‚è±Ô∏è Cronograma de Implementa√ß√£o

### **üöÄ MVP (Completo)**
- **Tempo**: 4-6 horas
- **Custo**: ~$65/m√™s
- **Ideal para**: Todas as funcionalidades, at√© 50 usu√°rios

### **üìà Produ√ß√£o B√°sica**
- **Tempo**: 1-2 dias
- **Custo**: ~$65/m√™s
- **Ideal para**: Lan√ßamento oficial

### **üè¢ Produ√ß√£o Escal√°vel**
- **Tempo**: 2-3 dias
- **Custo**: ~$185/m√™s
- **Ideal para**: Crescimento sustentado

---

**Recomenda√ß√£o**: Come√ßar com **MVP** para valida√ß√£o e migrar conforme crescimento
**Risco**: Baixo (com rollback autom√°tico)
**Benef√≠cios**: 
- ‚úÖ **Deploy autom√°tico** frontend + backend
- ‚úÖ **Escalabilidade** progressiva
- ‚úÖ **Monitoramento** integrado
- ‚úÖ **Rollback** autom√°tico em falhas
- ‚úÖ **Testes** autom√°ticos antes do deploy
- ‚úÖ **Custo otimizado** por fase

---

## üìã RESUMO EXECUTIVO - MVP CONFIRMADO

### **‚úÖ MVP Atualizado - TODAS as Funcionalidades Inclu√≠das**

Ap√≥s an√°lise completa da aplica√ß√£o, **o MVP foi ajustado para incluir TODAS as funcionalidades atuais:**

#### **üîß Infraestrutura T√©cnica**
- ‚úÖ **Express.js backend** com TypeScript completo
- ‚úÖ **Redis ElastiCache** (t3.micro) - **OBRIGAT√ìRIO** para WebSocket
- ‚úÖ **WebSocket Server** para comunica√ß√£o em tempo real
- ‚úÖ **Supabase PostgreSQL** + Storage para arquivos
- ‚úÖ **Sistema de autentica√ß√£o** com sess√µes seguras
- ‚úÖ **Observabilidade completa** com logs e m√©tricas

#### **ü§ñ Funcionalidades AI**
- ‚úÖ **OpenAI integration** para features de IA
- ‚úÖ **RAG system** com LangChain e embeddings
- ‚úÖ **AI Templates** para automa√ß√£o
- ‚úÖ **N8N workflows** para automa√ß√£o avan√ßada

#### **üì± Integra√ß√µes Externas**
- ‚úÖ **WhatsApp Business** via Evolution API
- ‚úÖ **Google Calendar** sync bidirecional com webhooks
- ‚úÖ **Google OAuth** para autentica√ß√£o
- ‚úÖ **Upload de arquivos** com Supabase Storage

#### **üíº Sistema Completo de Neg√≥cio**
- ‚úÖ **Sistema de conversas** com IA em tempo real
- ‚úÖ **CRM e pipeline** de vendas completo
- ‚úÖ **Anamneses** com formul√°rios din√¢micos
- ‚úÖ **Calend√°rio e agendamentos** integrados
- ‚úÖ **Prontu√°rios m√©dicos** digitais
- ‚úÖ **Analytics e relat√≥rios** em tempo real
- ‚úÖ **Gerenciamento de equipe** e permiss√µes
- ‚úÖ **Sistema multi-tenant** com isolamento

### **üí∞ Custo Ajustado: $65/m√™s (vs $35 inicial)**

**Justificativa do Aumento:**
- **Redis obrigat√≥rio**: +$15/m√™s (necess√°rio para WebSocket)
- **t3.small necess√°rio**: +$7/m√™s (Redis + WebSocket + AI)
- **Funcionalidades completas**: Todas inclu√≠das no MVP

### **üéØ Capacidade do MVP**
- **üë• Usu√°rios**: At√© 50 simult√¢neos
- **üîÑ Funcionalidades**: 100% da aplica√ß√£o atual
- **‚ö° Performance**: Adequada para valida√ß√£o e crescimento inicial
- **üöÄ Escalabilidade**: Migra√ß√£o simples quando necess√°rio

### **üìÖ Pr√≥ximos Passos Imediatos**
1. ‚úÖ **Aprovar plano atualizado** ($65/m√™s MVP completo)
2. üîß **Configurar secrets** GitHub Actions
3. üöÄ **Deploy MVP** com todas as funcionalidades
4. üß™ **Testes completos** em produ√ß√£o
5. üìà **Migrar para escal√°vel** quando atingir 50+ usu√°rios

**‚è±Ô∏è Tempo de implementa√ß√£o**: 4-6 horas para MVP completo
**üéØ Resultado**: Sistema 100% funcional na AWS com CI/CD autom√°tico 